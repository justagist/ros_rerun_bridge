# this can be used with the example from nav2 starter doc: https://docs.nav2.org/getting_started/index.html
# Run that example, and in another terminal run:
# rerun_ros_bridge --config <path_to_rerun_ros_bridge>/example_configs/turtlebot3_nav2.config.yaml

global_frame: map

modules:
  # Camera intrinsics → Pinhole at map/robot/camera/img
  - name: camera_info
    module: camera_info
    topic: /intel_realsense_r200_depth/camera_info
    entity_path: map/robot/camera/img

  # RGB image + transform for the camera rig
  - name: rgb_image
    module: image
    topic: /intel_realsense_r200_depth/image_raw
    entity_path: map/robot/camera/img
    extra:
      # optional: desired cv_bridge encoding
      encoding_override: null
      tf_paths:
        - path: map/robot/camera
          child_frame: camera_rgb_optical_frame
          parent_frame: base_footprint

  # Depth point cloud: log once under camera-centric path and once under map
  - name: depth_points
    module: pointcloud2
    topic: /intel_realsense_r200_depth/points
    entity_path: map/robot/camera/points
    extra:
      color_mode: rgb_packed
      tf_paths:
        # Robot-centric (camera frame relative to camera optical frame)
        - path: map/robot/camera/points
          child_frame: camera_depth_frame
          parent_frame: camera_rgb_optical_frame
        # Map-centric (same child, placed under map)
        - path: map/points
          child_frame: camera_depth_frame
          parent_frame: map

  # Particle cloud → arrows + transform for the particle cloud
  - name: particles_arrows
    module: particle_cloud
    topic: /particle_cloud
    entity_path: map/particlecloud_arrows
    extra:
      mode: arrows
      arrow_axis: x # use body X as heading
      arrow_len: 0.05 # meters, scaled by weight
      arrow_radius: 0.002
      colour: [0, 255, 0, 255] # green

  # Laser scan → line strips + transform for the scanner
  - name: scan
    module: laserscan
    topic: /scan
    entity_path: map/robot/scan
    extra:
      mode: lines
      origin_scale: 0.3
      radius: 0.0025
      tf_paths:
        - path: map/robot/scan
          child_frame: base_scan
          parent_frame: base_footprint

  # Odometry → scalar plots + robot pose under map
  - name: odom
    module: odometry
    topic: /odom
    entity_path: odometry
    extra:
      tf_paths:
        - path: map/robot
          child_frame: base_footprint
          parent_frame: map

  # URDF logged once (latching /robot_description)
  - name: urdf
    module: urdf
    topic: /robot_description
    entity_path: map/robot/urdf
    qos: { depth: 1, durability: transient_local }
    extra:
      link_scales:
        camera_link: 0.00254
